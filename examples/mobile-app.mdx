# Mobile App Integration

This example demonstrates how to integrate the Harbor Parking API into a mobile application using React Native.

## Overview

The Harbor Parking API is designed to work seamlessly with mobile applications. This example shows how to build a React Native app that allows users to browse available parking spots, claim them, and manage their own spots.

## Project Setup

### 1. Initialize React Native Project

```bash
npx react-native init HarborParkingApp --template react-native-template-typescript
cd HarborParkingApp
```

### 2. Install Dependencies

```bash
npm install @react-navigation/native @react-navigation/stack
npm install react-native-vector-icons
npm install @react-native-async-storage/async-storage
npm install react-native-elements
```

### 3. API Client Setup

Create an API client for the Harbor Parking API:

```typescript
// src/api/client.ts
import AsyncStorage from '@react-native-async-storage/async-storage';

const API_BASE_URL = 'https://parking.lapscher.com/api';

class HarborParkingAPI {
  private async getAuthToken(): Promise<string | null> {
    return await AsyncStorage.getItem('auth_token');
  }

  private async makeRequest(endpoint: string, options: RequestInit = {}) {
    const token = await this.getAuthToken();
    
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        ...(token && { Authorization: `Bearer ${token}` }),
        ...options.headers,
      },
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error || 'API request failed');
    }

    return response.json();
  }

  // Authentication
  async login(email: string, password: string) {
    const response = await fetch(`${API_BASE_URL}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password }),
    });

    const data = await response.json();
    
    if (response.ok) {
      await AsyncStorage.setItem('auth_token', data.access_token);
      await AsyncStorage.setItem('user', JSON.stringify(data.user));
    }

    return data;
  }

  async logout() {
    await AsyncStorage.removeItem('auth_token');
    await AsyncStorage.removeItem('user');
  }

  // Dashboard
  async getDashboard() {
    return this.makeRequest('/dashboard');
  }

  // Parking Spots
  async getParkingSpots() {
    return this.makeRequest('/parking-spots');
  }

  async createParkingSpot(spotData: {
    spot_number: string;
    location: string;
    notes?: string;
  }) {
    return this.makeRequest('/parking-spots', {
      method: 'POST',
      body: JSON.stringify(spotData),
    });
  }

  // Availabilities
  async getAvailabilities() {
    return this.makeRequest('/availabilities?available=true');
  }

  async createAvailability(availabilityData: {
    spot_id: string;
    start_time: string;
    end_time: string;
    notes?: string;
  }) {
    return this.makeRequest('/availabilities', {
      method: 'POST',
      body: JSON.stringify(availabilityData),
    });
  }

  // Claims
  async createClaim(claimData: {
    availability_id: string;
    notes?: string;
  }) {
    return this.makeRequest('/claims', {
      method: 'POST',
      body: JSON.stringify(claimData),
    });
  }

  async getMyClaims() {
    return this.makeRequest('/claims');
  }
}

export const api = new HarborParkingAPI();
```

## Screens Implementation

### 1. Login Screen

```typescript
// src/screens/LoginScreen.tsx
import React, { useState } from 'react';
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  StyleSheet,
  Alert,
} from 'react-native';
import { api } from '../api/client';

export const LoginScreen = ({ navigation }: any) => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);

  const handleLogin = async () => {
    if (!email || !password) {
      Alert.alert('Error', 'Please fill in all fields');
      return;
    }

    setLoading(true);
    try {
      await api.login(email, password);
      navigation.replace('Dashboard');
    } catch (error) {
      Alert.alert('Login Failed', error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Harbor Parking</Text>
      <TextInput
        style={styles.input}
        placeholder="Email"
        value={email}
        onChangeText={setEmail}
        keyboardType="email-address"
        autoCapitalize="none"
      />
      <TextInput
        style={styles.input}
        placeholder="Password"
        value={password}
        onChangeText={setPassword}
        secureTextEntry
      />
      <TouchableOpacity
        style={styles.button}
        onPress={handleLogin}
        disabled={loading}
      >
        <Text style={styles.buttonText}>
          {loading ? 'Signing In...' : 'Sign In'}
        </Text>
      </TouchableOpacity>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    padding: 20,
    backgroundColor: '#1f2937',
  },
  title: {
    fontSize: 32,
    fontWeight: 'bold',
    textAlign: 'center',
    marginBottom: 40,
    color: '#ffffff',
  },
  input: {
    backgroundColor: '#374151',
    borderRadius: 8,
    padding: 15,
    marginBottom: 15,
    color: '#ffffff',
  },
  button: {
    backgroundColor: '#3b82f6',
    borderRadius: 8,
    padding: 15,
    alignItems: 'center',
  },
  buttonText: {
    color: '#ffffff',
    fontSize: 16,
    fontWeight: 'bold',
  },
});
```

### 2. Dashboard Screen

```typescript
// src/screens/DashboardScreen.tsx
import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  FlatList,
  TouchableOpacity,
  StyleSheet,
  RefreshControl,
} from 'react-native';
import { api } from '../api/client';

export const DashboardScreen = ({ navigation }: any) => {
  const [dashboardData, setDashboardData] = useState<any>(null);
  const [refreshing, setRefreshing] = useState(false);

  const loadDashboard = async () => {
    try {
      const data = await api.getDashboard();
      setDashboardData(data);
    } catch (error) {
      console.error('Failed to load dashboard:', error);
    }
  };

  const onRefresh = async () => {
    setRefreshing(true);
    await loadDashboard();
    setRefreshing(false);
  };

  useEffect(() => {
    loadDashboard();
  }, []);

  const renderSpotItem = ({ item }: any) => (
    <TouchableOpacity
      style={styles.spotItem}
      onPress={() => navigation.navigate('SpotDetails', { spot: item })}
    >
      <Text style={styles.spotNumber}>Spot {item.spot_number}</Text>
      <Text style={styles.spotLocation}>{item.location}</Text>
      <Text style={styles.spotStatus}>
        {item.is_verified ? 'Verified' : 'Pending Approval'}
      </Text>
    </TouchableOpacity>
  );

  if (!dashboardData) {
    return (
      <View style={styles.container}>
        <Text style={styles.loadingText}>Loading...</Text>
      </View>
    );
  }

  return (
    <View style={styles.container}>
      <View style={styles.header}>
        <Text style={styles.title}>Dashboard</Text>
        <TouchableOpacity
          style={styles.addButton}
          onPress={() => navigation.navigate('AddSpot')}
        >
          <Text style={styles.addButtonText}>+ Add Spot</Text>
        </TouchableOpacity>
      </View>

      <View style={styles.statsContainer}>
        <View style={styles.statItem}>
          <Text style={styles.statNumber}>{dashboardData.stats.mySpots}</Text>
          <Text style={styles.statLabel}>My Spots</Text>
        </View>
        <View style={styles.statItem}>
          <Text style={styles.statNumber}>
            {dashboardData.stats.availableSpots}
          </Text>
          <Text style={styles.statLabel}>Available</Text>
        </View>
        <View style={styles.statItem}>
          <Text style={styles.statNumber}>
            {dashboardData.stats.activeClaims}
          </Text>
          <Text style={styles.statLabel}>My Claims</Text>
        </View>
      </View>

      <FlatList
        data={dashboardData.mySpots}
        renderItem={renderSpotItem}
        keyExtractor={(item) => item.id}
        refreshControl={
          <RefreshControl refreshing={refreshing} onRefresh={onRefresh} />
        }
        ListEmptyComponent={
          <Text style={styles.emptyText}>No parking spots registered</Text>
        }
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#1f2937',
  },
  header: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    padding: 20,
    borderBottomWidth: 1,
    borderBottomColor: '#374151',
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#ffffff',
  },
  addButton: {
    backgroundColor: '#3b82f6',
    paddingHorizontal: 15,
    paddingVertical: 8,
    borderRadius: 6,
  },
  addButtonText: {
    color: '#ffffff',
    fontWeight: 'bold',
  },
  statsContainer: {
    flexDirection: 'row',
    padding: 20,
    gap: 20,
  },
  statItem: {
    flex: 1,
    alignItems: 'center',
    backgroundColor: '#374151',
    padding: 15,
    borderRadius: 8,
  },
  statNumber: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#3b82f6',
  },
  statLabel: {
    fontSize: 12,
    color: '#9ca3af',
    marginTop: 5,
  },
  spotItem: {
    backgroundColor: '#374151',
    margin: 10,
    padding: 15,
    borderRadius: 8,
  },
  spotNumber: {
    fontSize: 18,
    fontWeight: 'bold',
    color: '#ffffff',
  },
  spotLocation: {
    fontSize: 14,
    color: '#9ca3af',
    marginTop: 5,
  },
  spotStatus: {
    fontSize: 12,
    color: '#10b981',
    marginTop: 5,
  },
  loadingText: {
    textAlign: 'center',
    color: '#ffffff',
    marginTop: 50,
  },
  emptyText: {
    textAlign: 'center',
    color: '#9ca3af',
    marginTop: 50,
  },
});
```

### 3. Available Spots Screen

```typescript
// src/screens/AvailableSpotsScreen.tsx
import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  FlatList,
  TouchableOpacity,
  StyleSheet,
  Alert,
} from 'react-native';
import { api } from '../api/client';

export const AvailableSpotsScreen = ({ navigation }: any) => {
  const [availableSpots, setAvailableSpots] = useState([]);
  const [loading, setLoading] = useState(true);

  const loadAvailableSpots = async () => {
    try {
      const data = await api.getAvailabilities();
      setAvailableSpots(data.availabilities);
    } catch (error) {
      Alert.alert('Error', 'Failed to load available spots');
    } finally {
      setLoading(false);
    }
  };

  const handleClaimSpot = async (availability: any) => {
    try {
      await api.createClaim({
        availability_id: availability.id,
        notes: 'Claimed via mobile app',
      });
      Alert.alert('Success', 'Spot claimed successfully!');
      loadAvailableSpots(); // Refresh the list
    } catch (error) {
      Alert.alert('Error', error.message);
    }
  };

  useEffect(() => {
    loadAvailableSpots();
  }, []);

  const renderSpotItem = ({ item }: any) => (
    <View style={styles.spotItem}>
      <View style={styles.spotInfo}>
        <Text style={styles.spotNumber}>
          Spot {item.parking_spots.spot_number}
        </Text>
        <Text style={styles.spotLocation}>
          {item.parking_spots.location}
        </Text>
        <Text style={styles.ownerInfo}>
          Owner: {item.parking_spots.profiles.full_name}
        </Text>
        <Text style={styles.timeInfo}>
          {new Date(item.start_time).toLocaleString()} -{' '}
          {new Date(item.end_time).toLocaleString()}
        </Text>
      </View>
      <TouchableOpacity
        style={styles.claimButton}
        onPress={() => handleClaimSpot(item)}
      >
        <Text style={styles.claimButtonText}>Claim Spot</Text>
      </TouchableOpacity>
    </View>
  );

  if (loading) {
    return (
      <View style={styles.container}>
        <Text style={styles.loadingText}>Loading available spots...</Text>
      </View>
    );
  }

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Available Spots</Text>
      <FlatList
        data={availableSpots}
        renderItem={renderSpotItem}
        keyExtractor={(item) => item.id}
        ListEmptyComponent={
          <Text style={styles.emptyText}>No spots available</Text>
        }
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#1f2937',
    padding: 20,
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#ffffff',
    marginBottom: 20,
  },
  spotItem: {
    backgroundColor: '#374151',
    padding: 15,
    borderRadius: 8,
    marginBottom: 15,
  },
  spotInfo: {
    marginBottom: 15,
  },
  spotNumber: {
    fontSize: 18,
    fontWeight: 'bold',
    color: '#ffffff',
  },
  spotLocation: {
    fontSize: 14,
    color: '#9ca3af',
    marginTop: 5,
  },
  ownerInfo: {
    fontSize: 14,
    color: '#9ca3af',
    marginTop: 5,
  },
  timeInfo: {
    fontSize: 12,
    color: '#10b981',
    marginTop: 5,
  },
  claimButton: {
    backgroundColor: '#10b981',
    padding: 10,
    borderRadius: 6,
    alignItems: 'center',
  },
  claimButtonText: {
    color: '#ffffff',
    fontWeight: 'bold',
  },
  loadingText: {
    textAlign: 'center',
    color: '#ffffff',
    marginTop: 50,
  },
  emptyText: {
    textAlign: 'center',
    color: '#9ca3af',
    marginTop: 50,
  },
});
```

## Navigation Setup

```typescript
// src/navigation/AppNavigator.tsx
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createStackNavigator } from '@react-navigation/stack';
import { LoginScreen } from '../screens/LoginScreen';
import { DashboardScreen } from '../screens/DashboardScreen';
import { AvailableSpotsScreen } from '../screens/AvailableSpotsScreen';

const Stack = createStackNavigator();

export const AppNavigator = () => {
  return (
    <NavigationContainer>
      <Stack.Navigator
        initialRouteName="Login"
        screenOptions={{
          headerStyle: {
            backgroundColor: '#1f2937',
          },
          headerTintColor: '#ffffff',
          headerTitleStyle: {
            fontWeight: 'bold',
          },
        }}
      >
        <Stack.Screen
          name="Login"
          component={LoginScreen}
          options={{ headerShown: false }}
        />
        <Stack.Screen name="Dashboard" component={DashboardScreen} />
        <Stack.Screen name="AvailableSpots" component={AvailableSpotsScreen} />
      </Stack.Navigator>
    </NavigationContainer>
  );
};
```

## Key Features

1. **Authentication**: Secure JWT token storage and management
2. **Real-time Updates**: Pull-to-refresh functionality
3. **Error Handling**: User-friendly error messages
4. **Offline Support**: Basic offline state management
5. **Responsive Design**: Works on different screen sizes

## Best Practices

1. **Token Management**: Store tokens securely using AsyncStorage
2. **Error Handling**: Provide clear error messages to users
3. **Loading States**: Show loading indicators during API calls
4. **Refresh Logic**: Implement pull-to-refresh for real-time data
5. **Navigation**: Use proper navigation patterns for mobile apps

This example provides a solid foundation for building a mobile app that integrates with the Harbor Parking API. You can extend it with additional features like push notifications, offline caching, and more advanced UI components.
